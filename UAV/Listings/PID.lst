C251 COMPILER V5.60.0,  PID                                                                31/07/24  22:43:52  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE PID
OBJECT MODULE PLACED IN .\Objects\PID.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE Code\PID.c XSMALL ROM(HUGE) BROWSE INCDIR(.\Code;.\Debugware) DEBUG PR
                    -INT(.\Listings\PID.lst) OBJECT(.\Objects\PID.obj) 

stmt  level    source

    1          /*
    2           * PID.c
    3           *
    4           *  Created on: Jul 13, 2024
    5           *      Author: qian-jing
    6           */
    7          
    8          float Angle_X_I=0;      //å­˜å‚¨Xç›¸å·®è§’åº¦çš„ç´¯è®¡å€¼
    9          float Angle_Y_I=0;      //å­˜å‚¨Yç›¸å·®è§’åº¦çš„ç´¯è®¡å€¼
   10          float Height_I  =0;     //å­˜å‚¨ç›¸å·®é«˜åº¦çš„ç´¯è®¡å€¼
   11          float Yaw_I             =0;     //å®šä¹‰å­˜å‚¨åèˆªè§’åº¦ç´¯è®¡çš„å˜é‡
   12          
   13          float pid_angleX(float TargetAngle,float RTAngle,float RTGyro,float Kp, float Ki,float Kd)
   14          {
   15   1              float Angle=0;
   16   1              Angle=RTAngle-TargetAngle;//è·å–ç›®æ ‡è§’åº¦å’Œç›®å‰è§’åº¦çš„å·®å€¼
   17   1              Angle_X_I+=Angle;               //è§’åº¦ç§¯åˆ†ç´¯ç§¯
   18   1              if(Angle_X_I>30)
   19   1              {
   20   2                      Angle_X_I=30;
   21   2              }
   22   1              return Kp*Angle-Ki*Angle_X_I+Kd*RTGyro;
   23   1      }
   24          float pid_angleY(float TargetAngle,float RTAngle,float RTGyro,float Kp, float Ki,float Kd)
   25          {
   26   1              float Angle=0;                                          //å®šä¹‰å­˜å‚¨å½“å‰è§’åº¦çš„å˜é‡
   27   1              Angle=RTAngle-TargetAngle;//è·å–ç›®æ ‡è§’åº¦å’Œç›®å‰è§’åº¦çš„å·®å€¼
   28   1              Angle_Y_I+=Angle;               //è§’åº¦ç§¯åˆ†ç´¯è®¡
   29   1              return Kp*Angle-Ki*Angle_Y_I+Kd*RTGyro; //è¿”å›è°ƒæ•´å€¼ doubleç±»å‹
   30   1      }
   31          float pid_yaw(float TargetYaw,float RTYaw,float Kp,float Ki,float Kd)
   32          {
   33   1              float Yaw=0;                                                                                                    //å®šä¹‰å­˜å‚¨å½“å‰åèˆªè§’åº¦çš„å˜é‡
   34   1              static float PastYaw=0;                                         //å®šä¹‰å­˜å‚¨ä¸Šä¸€æ¬¡è·å¾—çš„åèˆªè§’åº¦çš„å˜é‡
   35   1              float Yaw_D=0;                                                                                  //å®šä¹‰å­˜å‚¨åèˆªè§’åº¦å˜åŒ–é€Ÿåº¦çš„å˜é‡
   36   1              Yaw=RTYaw-TargetYaw;
   37   1              Yaw_D=RTYaw-PastYaw;                                                    //è·å–ç›®æ ‡è§’åº¦ä¸è®¾å®šåèˆªè§’åº¦çš„å·®
   38   1              PastYaw=Yaw;                                                                                            //è®°å½•è¿™ä¸€æ¬¡çš„å˜åŒ–è§’åº¦,å°†åœ¨ä¸‹ä¸€æ¬¡çš„æ—¶å€™ä½œä¸ºä¸Šä¸€æ¬¡çš„åèˆ
             -ªè§’åº¦ä½¿ç”¨,ç”¨äºè®¡ç®—åèˆªè§’åº¦çš„å˜åŒ–é€Ÿåº¦
   39   1              Yaw_I+=Yaw;                                                                                     //ç´¯è®¡è¯¯å·®
   40   1              return Kp*Yaw+Ki*Yaw_I+Kd*Yaw_D;//è¿”å›è°ƒæ•´å€¼ doubleç±»å‹
   41   1      }
   42          float pid_height(float TargetHeight,float RTHeight,float Kp,float Ki,float Kd)
   43          {
   44   1              float Height=0;                                 //å®šä¹‰å­˜å‚¨å½“å‰è§’åº¦çš„å˜é‡
   45   1              static float PastHeight=0;                      //å®šä¹‰å­˜å‚¨ä¸Šä¸€æ¬¡è·å¾—çš„é«˜åº¦çš„å˜é‡
   46   1              float Height_D=0;                               //å®šä¹‰å­˜å‚¨é«˜åº¦å˜åŒ–é€Ÿåº¦çš„å˜é‡
   47   1              Height=RTHeight-TargetHeight;                                                           //è®¡ç®—ç›¸å·®é«˜åº¦
   48   1              Height_D=Height-PastHeight;                                                                     //è®¡ç®—é«˜åº¦å˜åŒ–é‡
   49   1              PastHeight=Height;                                                                                                      //è®°å½•è¿™ä¸€æ¬¡çš„å˜åŒ–é‡,å°†åœ¨ä¸‹ä¸€æ¬¡çš„æ—¶å€™ä½œä¸ºä¸Šä¸€æ¬¡çš„é
             -«˜åº¦ä½¿ç”¨,ç”¨äºè®¡ç®—é«˜åº¦çš„å˜åŒ–é€Ÿåº¦
   50   1              Height_I+=Height;                                                                       //ç´¯è®¡ç›¸å·®è§’åº¦
   51   1      
   52   1              return Kp*Height+Ki*Height_I+Kd*Height_D;//è¿”å›è°ƒæ•´å€¼ doubleç±»å‹
   53   1      
   54   1      }
   55          void pid_setAngleXI(float val)
   56          {
C251 COMPILER V5.60.0,  PID                                                                31/07/24  22:43:52  PAGE 2   

   57   1              Angle_X_I=val;
   58   1      }
   59          void pid_setAngleYI(float val)
   60          {
   61   1              Angle_Y_I=val;
   62   1      }
   63          void pid_setHeightI(float val)
   64          {
   65   1              Height_I=val;
   66   1      }
   67          void pid_setYawI(float val)
   68          {
   69   1              Yaw_I=val;
   70   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =    ------     ------
  ecode size           =       374     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =        24         56
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        48     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
