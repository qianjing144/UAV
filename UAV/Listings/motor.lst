C251 COMPILER V5.60.0,  motor                                                              31/07/24  06:59:01  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE motor
OBJECT MODULE PLACED IN .\Objects\motor.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE Code\motor.c XSMALL ROM(HUGE) BROWSE INCDIR(.\Code;.\Debugware) DEBUG 
                    -PRINT(.\Listings\motor.lst) OBJECT(.\Objects\motor.obj) 

stmt  level    source

    1          /*
    2           * motor.c
    3           *
    4           *  Created on: Jul 13, 2024
    5           *      Author: qian-jing
    6           */
    7          #include <STC8051U.H>
    8          #include <intrins.h>
    9          #include "main.h"
   10          #include "motor.h"
   11          #include "timer.h"
   12          #ifdef DEBUG
               #include "oled.h"
               #endif
   15          
   16          #define PWM1_0 0x00
   17          #define PWM1_1 0x01
   18          #define PWM1_2 0x02
   19          
   20          #define PWM2_0 0x00
   21          #define PWM2_1 0x04
   22          #define PWM2_2 0x08
   23          
   24          #define PWM3_0 0x00
   25          #define PWM3_1 0x10
   26          #define PWM3_2 0x20
   27          
   28          #define PWM4_0 0x00
   29          #define PWM4_1 0x40
   30          #define PWM4_2 0x80
   31          #define PWM4_3 0xC0
   32          
   33          #define ENO1P  0x01
   34          #define ENO1N  0x02
   35          #define ENO2P  0x04
   36          #define ENO2N  0x08
   37          #define ENO3P  0x10
   38          #define ENO3N  0x20
   39          #define ENO4P  0x40
   40          #define ENO4N  0x80
   41          
   42          void Delay300ms(void)   //@24.000MHz
   43          {
   44   1              unsigned long edata i;
   45   1      
   46   1              _nop_();
   47   1              _nop_();
   48   1              i = 1799998UL;
   49   1              while (i) i--;
   50   1      }
   51          
   52          
   53          void motor_init()
   54          {
   55   1              
   56   1              PWMA_PS=0x55;//01010101
   57   1              PWMA_CCER1=0x00;
   58   1              PWMA_CCER2=0x00;
C251 COMPILER V5.60.0,  motor                                                              31/07/24  06:59:01  PAGE 2   

   59   1      //      
   60   1              PWMA_CCMR1=0x60;
   61   1              PWMA_CCMR2=0x60;
   62   1              PWMA_CCMR3=0x60;
   63   1              PWMA_CCMR4=0x60;
   64   1      //      
   65   1              PWMA_CCER1=0x11;//高电平有效
   66   1              PWMA_CCER2=0x11;//高电平有效
   67   1              
   68   1              //clkdiv 480  freq 50hz
   69   1              PWMA_PSCRH=(480-1)>>8;
   70   1              PWMA_PSCRL=(480-1);
   71   1              PWMA_ARRH=1000>>8;
   72   1              PWMA_ARRL=1000;
   73   1              
   74   1              PWMA_ENO=0x55;//0101 0101
   75   1              PWMA_BKR=0x80;
   76   1              PWMA_CR1=0x01;
   77   1              {
   78   2                      unsigned char i=0;
   79   2                      for(i=30;i<45;i++)
   80   2                      {
   81   3                              motor_control(i,i,i,i);
   82   3                              #ifdef DEBUG
                                       OLED_ShowNum(0,0,i,3,12,0);
                                       #endif
   85   3                              Delay300ms();
   86   3                      }
   87   2              }
   88   1      }
   89          
   90          void motor_control(int val1,int val2,int val3,int val4)
   91          {
   92   1              if(val1>1000)//防止值超过1000
   93   1              {
   94   2                      val1=1000;//将值限定在1000
   95   2              }
   96   1              else if(val1<0)
   97   1              {
   98   2                      val1=0;
   99   2              }
  100   1              
  101   1              if(val2>1000)//防止值超过1000
  102   1              {
  103   2                      val2=1000;//将值限定在1000
  104   2              }
  105   1              else if(val2<0)
  106   1              {
  107   2                      val2=0;
  108   2              }
  109   1              
  110   1              if(val3>1000)//防止值超过1000
  111   1              {
  112   2                      val3=1000;//将值限定在1000
  113   2              }
  114   1              else if(val3<0)
  115   1              {
  116   2                      val3=0;
  117   2              }
  118   1              
  119   1              if(val4>1000)//防止值超过1000
  120   1              {
  121   2                      val4=1000;//将值限定在1000
  122   2              }
  123   1              else if(val4<0)
  124   1              {
C251 COMPILER V5.60.0,  motor                                                              31/07/24  06:59:01  PAGE 3   

  125   2                      val4=0;
  126   2              }
  127   1              PWMA_CCR1H=val1>>8;
  128   1              PWMA_CCR1L=val1;
  129   1              PWMA_CCR2H=val2>>8;
  130   1              PWMA_CCR2L=val2;
  131   1              PWMA_CCR3H=val3>>8;
  132   1              PWMA_CCR3L=val3;
  133   1              PWMA_CCR4H=val4>>8;
  134   1              PWMA_CCR4L=val4;
  135   1      }
  136          void motor_1(int val)
  137          {
  138   1              if(val>1000)//防止值超过1000
  139   1              {
  140   2                      val=1000;//将值限定在1000
  141   2              }
  142   1              if(val<0)
  143   1              {
  144   2                      val=0;
  145   2              }
  146   1              PWMA_CCR1H=val>>8;
  147   1              PWMA_CCR1L=val;
  148   1      //      __HAL_TIM_SET_COMPARE(&htim2,TIM_CHANNEL_1,val);//设置占空比
  149   1      }
  150          void motor_2(int val)
  151          {
  152   1              if(val>1000)//防止值超过1000
  153   1              {
  154   2                      val=1000;//将值限定在1000
  155   2              }
  156   1              if(val<0)
  157   1              {
  158   2                      val=0;
  159   2              }
  160   1              PWMA_CCR2H=val>>8;
  161   1              PWMA_CCR2L=val;
  162   1      //      __HAL_TIM_SET_COMPARE(&htim2,TIM_CHANNEL_2,val);//设置占空比
  163   1      }
  164          void motor_3(int val)
  165          {
  166   1              if(val>1000)//防止值超过1000
  167   1              {
  168   2                      val=1000;//将值限定在1000
  169   2              }
  170   1              if(val<0)
  171   1              {
  172   2                      val=0;
  173   2              }
  174   1              PWMA_CCR3H=val>>8;
  175   1              PWMA_CCR3L=val;
  176   1      //      __HAL_TIM_SET_COMPARE(&htim2,TIM_CHANNEL_3,val);//设置占空比
  177   1      }
  178          void motor_4(int val)
  179          {
  180   1              if(val>1000)//防止值超过1000
  181   1              {
  182   2                      val=1000;//将值限定在1000
  183   2              }
  184   1              if(val<0)
  185   1              {
  186   2                      val=0;
  187   2              }
  188   1              PWMA_CCR4H=val>>8;
  189   1              PWMA_CCR4L=val;
  190   1      //      __HAL_TIM_SET_COMPARE(&htim2,TIM_CHANNEL_4,val);//设置占空比
C251 COMPILER V5.60.0,  motor                                                              31/07/24  06:59:01  PAGE 4   

  191   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =    ------     ------
  ecode size           =       509     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
